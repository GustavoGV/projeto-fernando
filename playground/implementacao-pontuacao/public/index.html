<html>
    <head>
        <meta charset="utf-8">
        <title></title>

        <style>
            table, td {
            
  border: 2px solid black;

}
            body {
                margin: 40px 0 0 0;
                padding: 0;
                background-color: #EEE;
                text-align: center;
                
            }
            
            #valorx {
                position: absolute;
                top: 25px;
                left: 800px;
            }
            #cx {
                position: absolute;
                top: 400px;
                left: 800px;
            }
            #fx {
                position: absolute;
                top: 75px;
                left: 800px;
            }
            #ck {
                position: absolute;
                top: 300px;
                left: 800px;

            }
            #fk {
                position: absolute;
                top: 350px;
                left: 800px;
            }
            #usuario {
                position: absolute;
                top: 650px;
                left: 800px;
            }
            #senha {
                position: absolute;
                top: 675px;
                left: 800px;
            }
            #bsenha { 
                position: absolute;
                top: 700px;
                left: 800px;
            }
            #valory {
                position: absolute;
                top: 225px;
                left: 800px;
            }
            #by {
                position: absolute;
                top: 250px;
                left: 800px;
            }
            #bsend {
                position: absolute;
                top: 600px;
                left: 800px;
            }

           </style>
           <table id="myTable">
            <tr>
              <td>Servicos</td>
              <td>Insumos</td>
              <td>Custo unitário</td>
              <td>Preco de Venda</td>
              <td>Vendas planejadas</td>
              <td>Faturamento Planejado</td>
            </tr>
            <tr>
                <td>147</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>148</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>149</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>157</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>158</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>159</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>257</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>258</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>259</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>267</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>268</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>269</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>347</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>348</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>349</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>357</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>358</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>359</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>367</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>368</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>369</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>Caixa</td>
                <td>Frota</td>
                <td>Promotores</td>
                <td>Soma propagandas<br>unitarias</td>
                <td>Propaganda<br>institucional</td>
                <td>Total do faturamento<br>esperado</td>
            </tr>
            <tr>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            <tr>
                <td>Comissao</td>
                <td>Distribuidores</td>
                <td>Turno</td>
                <td>PAS</td>
            </tr>
            <tr>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
            
          </table>
          
          
        <div>
            <button type="button" id="cx" onclick="eventox()">Pesquisar quais modelos de servico sao oferecidos pela concorrencia</button>
        </div> 
    

        
        <div>
            <button type="button" id="ck" onclick="eventok()">Pesquisar quantitade de PAS da concorrencia</button>
            <button type="button" id="fk" onclick="parareventok()">Pesquisar quantitade de distribuidores da concorrencia</button>
        </div>
        <div>
            <input type="text" value="Exemplo: 147 ou 147, 257" id="valory">
            <button type="button" id="by" onclick="sety()">Pesquisar a participacao de um ou dois modelos de servico</button>
        </div> 
        <div>
            <input type="text" value="3irmas" id="usuario">
            <input type="text" value="666" id="senha">
            <button type="button" id="bsenha" onclick="login()">Clique para fazer login</button>
        </div>
        <button type="button" id="bsend" onclick="send()">Clique aqui para finalizar suas escolhas do turno</button>

    </div>
</div>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body>

        <script>
            let duplo = 0
            let index = ["147","148",
"149",
"157",
"158",
"159",
"257",
"258",
"259",
"267",
"268",
"269",
"347",
"348",
"349",
"357",
"358",
"359",
"367",
"368",
"369"]
            function update(dados) {
                var table = document.getElementById("myTable");
                let somaf = 0;
                for(let i = 0; i < 21; i++){
                somaf = somaf + dados[i][4]*(dados[i][3] - dados[i][2]);
                table.rows[i+1].cells[1].innerHTML = dados[i][0]; // injeta o numero de insumos de cada servico na tabela do client
                table.rows[i+1].cells[2].innerHTML = dados[i][2]; // msm coisa /\ so q injeta os custos unitarios
                table.rows[i+1].cells[5].innerHTML = dados[i][4]*(dados[i][3] - dados[i][2]);
                table.rows[i+1].cells[3].innerHTML = dados[i][3]
                table.rows[i+1].cells[4].innerHTML = dados[i][4]
                
                table.rows[23].cells[5].innerHTML = 0
                if(dados[i][1] == 1){
                    table.rows[i+1].cells[0].style.backgroundColor = "green";
                }
                if(dados[i][1] == 2){
                    table.rows[i+1].cells[0].style.backgroundColor = "yellow"
                }
                if(dados[i][1] == 0){
                    table.rows[i+1].cells[0].style.backgroundColor
                }
            }
            table.rows[23].cells[4].innerHTML = dados[27]
            table.rows[22].cells[4].style.backgroundColor = "gray"
            table.rows[23].cells[5].innerHTML = somaf
            table.rows[23].cells[0].innerHTML = dados[21] //taokeys
            table.rows[22].cells[0].style.backgroundColor = "gray"
            table.rows[25].cells[0].innerHTML = dados[24] //comissao
            table.rows[24].cells[0].style.backgroundColor = "gray"
            table.rows[25].cells[3].innerHTML = dados[26] //pas
            table.rows[24].cells[3].style.backgroundColor = "gray"
            let sfrota = 0;
            for(let d = 0; d < dados[22].length; d++){
                sfrota = sfrota + dados[22][d]
            }
            table.rows[23].cells[1].innerHTML = sfrota //frota
            table.rows[22].cells[1].style.backgroundColor = "gray"
            table.rows[25].cells[1].innerHTML = dados[25] //distribuidores
            table.rows[24].cells[1].style.backgroundColor = "gray"
            table.rows[23].cells[2].innerHTML = dados[23] //promotores
            table.rows[22].cells[2].style.backgroundColor = "gray"
        }
            function tabela(dados) {
            var table = document.getElementById("myTable");
            //var row = table.insertRow(0);
            while(duplo == 0){
                let somaf = 0;
            for(let i = 0; i < 21; i++){
                somaf = somaf + dados[i][4]*(dados[i][3] - dados[i][2])
                table.rows[i+1].cells[1].innerHTML = dados[i][0]; // injeta o numero de insumos de cada servico na tabela do client
                table.rows[i+1].cells[2].innerHTML = dados[i][2]; // msm coisa /\ so q injeta os custos unitarios
                table.rows[i+1].cells[3].innerHTML = dados[i][3];
                table.rows[i+1].cells[4].innerHTML = dados[i][4];
                table.rows[i+1].cells[5].innerHTML = dados[i][4]*(dados[i][3] - dados[i][2]);

                if(dados[i][1] == 1){
                    table.rows[i+1].cells[0].style.backgroundColor = "green";
                }
                if(dados[i][1] == 2){
                    table.rows[i+1].cells[0].style.backgroundColor = "yellow"
                }
                if(dados[i][1] == 0){
                    table.rows[i+1].cells[0].style.backgroundColor
                }
                //table.rows[i+1].cells[2].innerHTML = dados[i][1];
                //table.rows[i+1].cells[2].innerHTML = dados[i][2];
                table.rows[i+1].cells[0].addEventListener('click', function(){
                    let dec = prompt('Deseja encerrar o servico ' + index[i] +' ou desfazer a decisao de cancelamento? (ENCERRAR ou DESFAZER)')
                   /*
                    if(dec.toUpperCase() == "COMPRAR"){
                        let decC = prompt('Deseja comprar o servico ' + index[i]+ '? (SIM ou NAO)')
                        if(decC.toUpperCase() == "SIM"){
                            socket.emit('comprar-servico', index[i])
                        }
                        else{
                            alert('Operacao nao concluida')
                        }
                    }
                    */
                    if(dec.toUpperCase() == "ENCERRAR"){
                        socket.emit('encerrar-servico', index[i])
                    }
                    else if(dec.toUpperCase() == "DESFAZER"){
                        socket.emit('desfazer-encerramento', index[i])
                    }
                    else{
                        alert('Acao solicitada incopativel com as escolhas disponiveis')
                    }
            })
                table.rows[i+1].cells[1].addEventListener('click', function(){
                    let dec = prompt('Qual evento deseja realizar? => COMPRAR - TROCAR')
                    if(dec.toUpperCase() == "COMPRAR"){
                        let decC = prompt('Quantos insumos do servico ' + index[i]+ ' voce deseja comprar?')
                        if(decC > 0){ // checar no server-side tb se o valor eh positivo
                            let dd = [index[i], decC]
                            socket.emit('comprar-servico', dd)
                        }
                        else{
                            alert('Operacao nao concluida')
                        }
                    }
                    else if(dec.toUpperCase() == "TROCAR"){
                            let decF = prompt('Deseja trocar o servico ' + index[i] + ' para envia-lo para qual servico? (EX: 257)')
                            let h = 0
                            for(let f = 0; f < index.length; f++){
                                if(decF == index[f]){
                                    let decFQ = prompt('Qual a quantidade de insumos que deseja transferir?')
                                    h = h + 1
                                    socket.emit('trocar-servico', [index[i], decF, decFQ])
                                    console.log(index[i] + ' ' + decF)
                                }
                            }
                            if(h == 0){
                                alert('o servico escolhido nao consta nos forncecidos')
                            }
                        }
                        else{alert('comando dado nao encontrado')}

            })  
                table.rows[i+1].cells[3].addEventListener('click', function(){ //precos unitarios
                    let decP = prompt('Qual valor unitario voce deseja oferecer para o servico ' + index[i] + '?')
                    let resp = [index[i], decP]
                    socket.emit('alterar-preco', resp)

            })
                table.rows[i+1].cells[4].addEventListener('click', function(){
                    let decN = prompt('Qual o volume de vendas que planeja ter para o serviço ' + index[i] + '?')
                    let resp = [index[i], decN]
                    socket.emit('alterar-volume', resp)
            })
                
            }
            table.rows[23].cells[4].innerHTML = dados[27]
            table.rows[22].cells[4].style.backgroundColor = "gray"
            table.rows[23].cells[5].innerHTML = somaf
            table.rows[23].cells[0].innerHTML = dados[21] //taokeys
            table.rows[22].cells[0].style.backgroundColor = "gray"
            table.rows[25].cells[0].innerHTML = dados[24] //comissao
            table.rows[24].cells[0].style.backgroundColor = "gray"
            table.rows[25].cells[3].innerHTML = dados[26] //pas
            table.rows[24].cells[3].style.backgroundColor = "gray"
            let sfrota = 0;
            for(let d = 0; d < dados[22].length; d++){
                sfrota = sfrota + dados[22][d]
            }
            table.rows[23].cells[1].innerHTML = sfrota //frota
            table.rows[22].cells[1].style.backgroundColor = "gray"
            table.rows[25].cells[1].innerHTML = dados[25] //distribuidores
            table.rows[24].cells[1].style.backgroundColor = "gray"
            table.rows[23].cells[2].innerHTML = dados[23] //promotores
            table.rows[22].cells[2].style.backgroundColor = "gray"

            table.rows[23].cells[1].addEventListener('click', function(){ //frota
                    let decN = prompt('Deseja aumentar a sua frota, vender algumas unidades ou checar o status da sua frota? (AUMENTAR ou VENDER ou CHECAR)')
                    if(decN.toUpperCase() == 'AUMENTAR'){
                        let aume = prompt('Deseja adquirir quantas unidades?')
                        socket.emit('aumentar-frota', aume)
                    }
                    else if(decN.toUpperCase() == 'VENDER'){
                        let vend = prompt('Deseja vender quantas unidades?')
                        socket.emit('vender-frota', vend)
                    }
                    else if(decN.toUpperCase() == 'CHECAR'){
                        socket.emit('checar-frota')
                    }
                    else{alert('comando nao disponivel')}
            })
            table.rows[23].cells[2].addEventListener('click', function(){ //promotor
                    let dec = prompt('Deseja aumentar ou diminuir o numero de promotores? (AUMENTAR ou DIMINUIR)')
                    if(dec.toUpperCase() == "AUMENTAR"){
                        let aume = prompt('Deseja adquirir quantos promotores?')
                        socket.emit('aumentar-promotores', aume)
                    }
                    else if(dec.toUpperCase() == "DIMINUIR"){
                        let dimi = prompt('Deseja dispensar quantos promotores?')
                        socket.emit('diminuir-promotores', dimi)
                    }
                    else{alert('comando nao disponivel')}
            })
            table.rows[25].cells[0].addEventListener('click', function(){ //comissao
                   let dec = prompt('Quanto de comissao deseja oferecer? EX: 0.3 (para 30%)')
                   socket.emit('comissao', dec)
            })
            table.rows[23].cells[4].addEventListener('click', function(){ //propaganda
                   let dec = prompt('Quanto deseja invetir em propagada institucional nesse turno?')
                   socket.emit('aumentar-propaganda', dec)
            })
            table.rows[25].cells[1].addEventListener('click', function(){ //distribuidores
                  let dec = prompt('Deseja aumentar ou diminuir o numero de distribuidores? (AUMENTAR ou DIMINUIR)')
                  if(dec.toUpperCase() == 'AUMENTAR'){
                    let aume = prompt('Quantos distribuidores deseja adquirir?')
                    socket.emit('aumentar-distribuidores', aume)
                  }
                  else if(dec.toUpperCase() == 'DIMINUIR'){
                    let dimi = prompt('Quantos distribuidores deseja dispensar?')
                    socket.emit('diminuir-distribuidores', dimi)
                  }
                  else{alert('Comando nao disponivel')}
            })
            table.rows[25].cells[3].addEventListener('click', function(){ //PAS
                  let dec = prompt('Deseja aumentar o PAS, diminuir ou checar seu status? (AUMENTAR ou DIMINUIR ou CHECAR)')
                  if(dec.toUpperCase() == 'AUMENTAR'){
                    let aume = prompt('Quantos PAS deseja adquirir?')
                    socket.emit('aumentar-pas', aume)
                  }
                  else if(dec.toUpperCase() == 'DIMINUIR'){
                    let dimi = prompt('Quantos PAS deseja desativar?')
                    socket.emit('diminuir-pas', dimi)
                  }
                  else if(dec.toUpperCase() == 'CHECAR'){
                      socket.emit('checar-pas')
                  }
                  else{alert('comando nao disponivel')}
            })

            duplo = duplo + 1
        }
            
            
}



            //se o <script n estiver com o type="module" o index.html fica incapaz de puxar os dados dos imports requisitados
        
            const socket = io()
            socket.on('connect', () => {
                function check_turno() {
                    socket.emit('check-turno')
                }
                setTimeout(check_turno, 3000)
                const playerId = socket.id
                // console.log(`Player connected on Client with id: ${playerId}`)
                // console.log('socket', socket)

                //const screen = document.getElementById('screen')
                //const scoreTable = document.getElementById('score-table')
                
                //setupScreen(screen, game)
                //renderScreen(screen, scoreTable, game, requestAnimationFrame, playerId)
            })

            socket.on('disconnect', () => {
                //console.log('Unsubscribing All')
                //keyboardListener.unsubscribeAll();
            })
            socket.on('dados-servicos', (dados) => {
                tabela(dados)
            })
            socket.on('resp-checar-pas', (dados) => {
                alert('Voce possue ' + dados[0] + ' PAS que entrarao em atividade apos um turno e possue ' + dados[1]+ ' PAS com dois turnos restantes para ativacao')
            })
            socket.on('resp-checar-frota', (dados) => {
                alert('0/24 depreciado: ' + dados[0] + '. 1/24 depreciados: ' + dados[1] + '. 2/24 depreciado: ' + dados[2] + '. 3/24 depreciados: ' + dados[3] +'. 4/24 depreciado: ' + dados[4] + '. 5/24 depreciados: ' + dados[5] +'. 6/24 depreciado: ' + dados[6] + '. 7/24 depreciados: ' + dados[7] +'. 8/24 depreciado: ' + dados[8] + '. 9/24 depreciados: ' + dados[9] +'. 10/24 depreciado: ' + dados[10] + '. 11/24 depreciados: ' + dados[11] +'. 12/24 depreciado: ' + dados[12] + '. 13/24 depreciados: ' + dados[13] +'. 14/24 depreciado: ' + dados[14] + '. 15/24 depreciados: ' + dados[15] +'. 16/24 depreciado: ' + dados[16] + '. 17/24 depreciados: ' + dados[17] +'. 18/24 depreciado: ' + dados[18] + '. 19/24 depreciados: ' + dados[19] +'. 20/24 depreciado: ' + dados[20] + '. 21/24 depreciados: ' + dados[21] +'. 22/24 depreciado: ' + dados[22] + '. 23/24 depreciados: ' + dados[1])
            })
            socket.on('update', (dados) => {
                update(dados)
                console.log(dados)
            })
            function send() {
                alert('Operacao Negada')
            }
            socket.on('login-negado', (cre) => {
                alert('login negado para tentativa de conexao com '+cre)
            })
            socket.on('operacao-negada', (motivo) => {
                alert('Operacao negada por ' + motivo)
            })
            socket.on('resposta-pesquisar-pas', () =>{
                alert('resultado: x')
            })
            socket.on('acesso-negado', () => {
                alert('Realize login para efetuar essa operacao')
            })
            socket.on('ja-conectado', (idd) => {alert('Voce ja esta conectado ' + idd)})
            socket.on('login-aprovado', (cre) => {
                alert('login aprovado para ' + cre)
            })
            function eventox() {
                socket.emit('alterar-porcetagem-comissao', 43)
                 }
            function sety() {
                socket.emit('alterar-porcetagem-comissao', 43)
                }
            function eventok() {
                socket.emit('pesquisar-pas', 43)
            }
            function parareventok() {
                socket.emit('alterar-porcetagem-comissao', 43)
            }
            function login() {
                let valor1 = document.getElementById("usuario").value
                let valor2 = document.getElementById("senha").value
                let valor = [valor1, valor2]
                socket.emit('login-client', valor)
                document.getElementById("usuario").value = ''
                document.getElementById("senha").value = ''

            }

        </script>
    </body>
</html>